<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aura | Aesthetic Engine Pro</title>
    
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='20' fill='%236366f1'/><path d='M30 70 L50 30 L70 70 M38 55 L62 55' stroke='white' stroke-width='8' fill='none' stroke-linejoin='round'/></svg>">

    <!-- Preloading Google Fonts (Selection of 20) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Poppins:wght@600&family=Roboto:wght@400;500&family=Montserrat:wght@700&family=Playfair+Display:ital,wght@0,700;1,700&family=Lora&family=Open+Sans&family=Oswald&family=Lato&family=Raleway&family=Merriweather&family=Ubuntu&family=Arvo&family=Dancing+Script:wght@700&family=Pacifico&family=Abril+Fatface&family=Quicksand:wght@500&family=Crimson+Text&family=Josefin+Sans:wght@600&family=Space+Grotesk:wght@600&display=swap" rel="stylesheet">

    <style>
        /* --- THEMES & VARIABLES --- */
        :root {
            --bg-app: #f1f5f9;
            --card-bg: #ffffff;
            --text-main: #0f172a;
            --text-muted: #64748b;
            --border-color: #e2e8f0;
            --radius: 16px;
            --shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            --current-font: 'Inter', sans-serif;
        }

        [data-theme="dark"] {
            --bg-app: #020617;
            --card-bg: #0f172a;
            --text-main: #f1f5f9;
            --text-muted: #94a3b8;
            --border-color: #1e293b;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            background-color: var(--bg-app);
            color: var(--text-main);
            font-family: var(--current-font);
            padding: 2rem;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .app-container { max-width: 1100px; margin: 0 auto; }

        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; }

        /* --- TOOLBAR --- */
        .toolbar {
            display: flex;
            gap: 1.5rem;
            background: var(--card-bg);
            padding: 1.5rem;
            border-radius: var(--radius);
            margin-bottom: 2rem;
            border: 1px solid var(--border-color);
            align-items: flex-end;
            flex-wrap: wrap;
        }

        .control-item { display: flex; flex-direction: column; gap: 0.5rem; }
        .control-item label { font-size: 0.7rem; font-weight: 800; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; }

        select, input[type="range"] { padding: 8px; border-radius: 6px; border: 1px solid var(--border-color); background: var(--bg-app); color: var(--text-main); font-family: inherit; cursor: pointer; }

        /* --- PREVIEW --- */
        .preview-card {
            background: var(--card-bg);
            padding: 3rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
            border: 1px solid var(--border-color);
            position: relative;
            border-top: 12px solid transparent;
            transition: border-color 0.3s ease;
        }

        .contrast-badge {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            padding: 0.5rem 1rem;
            border-radius: 50px;
            font-size: 0.7rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: var(--bg-app);
            border: 1px solid var(--border-color);
        }

        .status-dot { width: 8px; height: 8px; border-radius: 50%; }
        .pass { background: #10b981; }
        .fail { background: #f43f5e; }

        /* --- LAYOUT GRID --- */
        .main-grid { display: grid; grid-template-columns: 1fr 320px; gap: 2rem; }

        .palette-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); gap: 1rem; margin-bottom: 2rem; }
        .swatch {
            height: 120px;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            padding: 12px;
            cursor: copy;
            border: 1px solid rgba(0,0,0,0.05);
            transition: transform 0.2s, box-shadow 0.2s;
            position: relative;
        }
        .swatch:hover { transform: translateY(-3px); box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); }
        .swatch span { font-size: 0.7rem; font-weight: 800; background: white; color: #000; padding: 3px 7px; border-radius: 4px; width: fit-content; pointer-events: none; }
        
        .swatch::after {
            content: 'Click to Copy';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.7);
            color: white;
            font-size: 0.6rem;
            padding: 4px 8px;
            border-radius: 4px;
            opacity: 0;
            transition: opacity 0.2s;
        }
        .swatch:hover::after { opacity: 1; }

        .lock-btn { position: absolute; top: 10px; right: 10px; background: rgba(255,255,255,0.8); border: none; border-radius: 4px; padding: 4px; cursor: pointer; font-size: 1rem; z-index: 2; transition: background 0.2s; }
        .lock-btn:hover { background: #fff; }

        /* --- SIDEBAR --- */
        .saved-grid { display: flex; flex-direction: column; gap: 12px; max-height: 500px; overflow-y: auto; }
        .saved-item {
            display: flex;
            align-items: center;
            background: var(--card-bg);
            padding: 10px;
            border-radius: 10px;
            border: 1px solid var(--border-color);
            justify-content: space-between;
        }
        .mini-group { display: flex; gap: 4px; cursor: pointer; }
        .mini-swatch { width: 22px; height: 22px; border-radius: 4px; border: 1px solid rgba(0,0,0,0.1); }

        /* --- BUTTONS --- */
        .btn-main { background: var(--text-main); color: var(--card-bg); border: none; padding: 0.8rem 1.5rem; border-radius: 8px; cursor: pointer; font-weight: 600; font-family: inherit; transition: opacity 0.2s; }
        .btn-main:hover { opacity: 0.9; }
        .btn-icon { background: var(--card-bg); border: 1px solid var(--border-color); padding: 8px 12px; border-radius: 8px; cursor: pointer; font-size: 1.2rem; }
        .btn-sec { background: transparent; border: 1px solid var(--border-color); color: var(--text-main); padding: 4px 8px; border-radius: 6px; cursor: pointer; font-size: 0.8rem; }

        .icon-moon { display: none; }
        [data-theme="dark"] .icon-sun { display: none; }
        [data-theme="dark"] .icon-moon { display: inline; }

        .code-block { background: #1e1e1e; color: #d4d4d4; padding: 1.5rem; border-radius: 12px; font-family: monospace; font-size: 0.85rem; overflow-x: auto; position: relative; }
        
        /* Toast notification */
        #toast {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            background: #0f172a;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 50px;
            font-size: 0.9rem;
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.3);
            display: none;
            z-index: 1000;
        }

        @media (max-width: 900px) { .main-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

    <main class="app-container">
        <header>
            <div>
                <h1 id="brand-logo" style="font-family: 'Poppins';">Aura</h1>
                <p style="font-size: 0.8rem; color: var(--text-muted);">Pro Design Token Generator</p>
            </div>
            <div style="display:flex; gap: 10px; align-items: center;">
                <button id="theme-btn" class="btn-icon" title="Toggle Theme">
                    <span class="icon-sun">‚òÄÔ∏è</span>
                    <span class="icon-moon">üåô</span>
                </button>
                <button id="gen-btn" class="btn-main">Regenerate (Space)</button>
            </div>
        </header>

        <section class="toolbar">
            <div class="control-item">
                <label>Base Color</label>
                <input type="color" id="base-color" value="#6366f1" style="height: 40px; border:none; background:none; cursor:pointer;">
            </div>
            <div class="control-item">
                <label>Harmony Mode</label>
                <select id="harmony-type">
                    <option value="analogous">Analogous</option>
                    <option value="monochrome">Monochrome</option>
                    <option value="complementary">Complementary</option>
                    <option value="triadic">Triadic</option>
                    <option value="random">Pure Random</option>
                </select>
            </div>
            <div class="control-item">
                <label>Saturation</label>
                <input type="range" id="sat-slider" min="0" max="100" value="70">
            </div>
            <div class="control-item">
                <label>Typography</label>
                <select id="font-selector">
                    <!-- 20 Varied Google Fonts -->
                    <option value="'Inter', sans-serif">Inter</option>
                    <option value="'Poppins', sans-serif">Poppins</option>
                    <option value="'Roboto', sans-serif">Roboto</option>
                    <option value="'Montserrat', sans-serif">Montserrat</option>
                    <option value="'Playfair Display', serif">Playfair Display</option>
                    <option value="'Space Grotesk', sans-serif">Space Grotesk</option>
                    <option value="'Lora', serif">Lora</option>
                    <option value="'Open Sans', sans-serif">Open Sans</option>
                    <option value="'Oswald', sans-serif">Oswald</option>
                    <option value="'Lato', sans-serif">Lato</option>
                    <option value="'Raleway', sans-serif">Raleway</option>
                    <option value="'Merriweather', serif">Merriweather</option>
                    <option value="'Ubuntu', sans-serif">Ubuntu</option>
                    <option value="'Arvo', serif">Arvo</option>
                    <option value="'Dancing Script', cursive">Dancing Script</option>
                    <option value="'Pacifico', cursive">Pacifico</option>
                    <option value="'Abril Fatface', cursive">Abril Fatface</option>
                    <option value="'Quicksand', sans-serif">Quicksand</option>
                    <option value="'Crimson Text', serif">Crimson Text</option>
                    <option value="'Josefin Sans', sans-serif">Josefin Sans</option>
                </select>
            </div>
        </section>

        <section class="preview-card" id="preview-box">
            <div class="contrast-badge">
                <div id="status-dot" class="status-dot"></div>
                <span id="contrast-text">Contrast: --</span>
            </div>
            <h2 id="heading-text" style="font-size: 2.5rem; margin-bottom: 0.5rem;">Visual Clarity</h2>
            <p id="preview-body" style="margin-bottom: 2rem; max-width: 500px; opacity: 0.85;">Generate accessible color palettes using professional harmony modes and real-time WCAG contrast checking. Now featuring typography pairing.</p>
            <button id="preview-btn" class="btn-main">Action Button</button>
        </section>

        <div class="main-grid">
            <section>
                <div style="display:flex; justify-content:space-between; margin-bottom:1rem; align-items:center;">
                    <h3>Live Palette</h3>
                    <button id="save-btn" class="btn-main" style="padding: 8px 16px; font-size: 0.8rem;">Save Palette</button>
                </div>
                <div id="palette" class="palette-grid"></div>
                
                <h3>CSS Export</h3>
                <div class="code-block" style="margin-top: 1rem;"><pre id="css-export"></pre></div>
            </section>

            <aside>
                <h3>Saved Favorites</h3>
                <div id="saved-container" class="saved-grid" style="margin-top:1.2rem;"></div>
            </aside>
        </div>
    </main>

    <div id="toast">Copied to clipboard!</div>

    <script>
        const baseColorInput = document.getElementById('base-color');
        const harmonyInput = document.getElementById('harmony-type');
        const satInput = document.getElementById('sat-slider');
        const fontSelector = document.getElementById('font-selector');
        const genBtn = document.getElementById('gen-btn');
        const paletteContainer = document.getElementById('palette');
        const savedContainer = document.getElementById('saved-container');
        const cssExport = document.getElementById('css-export');
        const previewBox = document.getElementById('preview-box');
        const headingText = document.getElementById('heading-text');
        const previewBtn = document.getElementById('preview-btn');
        const themeBtn = document.getElementById('theme-btn');
        const toast = document.getElementById('toast');

        let currentPalette = [
            { name: '--primary', hex: '', locked: false },
            { name: '--secondary', hex: '', locked: false },
            { name: '--accent', hex: '', locked: false },
            { name: '--surface', hex: '', locked: false }
        ];

        let savedItems = JSON.parse(localStorage.getItem('aura_vault')) || [];

        // --- Utils ---
        function showToast(msg) {
            toast.innerText = msg;
            toast.style.display = 'block';
            setTimeout(() => { toast.style.display = 'none'; }, 2000);
        }

        function copyToClipboard(text) {
            const el = document.createElement('textarea');
            el.value = text;
            document.body.appendChild(el);
            el.select();
            document.execCommand('copy');
            document.body.removeChild(el);
            showToast(`Copied: ${text.toUpperCase()}`);
        }

        // --- Color Math ---
        function hexToHSL(hex) {
            let r = parseInt(hex.slice(1,3),16)/255, g = parseInt(hex.slice(3,5),16)/255, b = parseInt(hex.slice(5,7),16)/255;
            let max = Math.max(r,g,b), min = Math.min(r,g,b), h, s, l = (max+min)/2;
            if(max==min) h=s=0;
            else {
                let d = max-min;
                s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
                if(max==r) h = (g - b) / d + (g < b ? 6 : 0);
                else if(max==g) h = (b - r) / d + 2;
                else h = (r - g) / d + 4;
                h /= 6;
            }
            return { h: h*360, s: s*100, l: l*100 };
        }

        function hslToHex(h, s, l) {
            l /= 100; s /= 100;
            const a = s * Math.min(l, 1 - l);
            const f = n => {
                const k = (n + h / 30) % 12;
                const color = l - a * Math.max(Math.min(k - 3, 9 - k, 1), -1);
                return Math.round(255 * color).toString(16).padStart(2, '0');
            };
            return `#${f(0)}${f(8)}${f(4)}`;
        }

        function getLuminance(hex) {
            const rgb = [1,3,5].map(p => {
                let v = parseInt(hex.slice(p, p+2), 16) / 255;
                return v <= 0.03928 ? v / 12.92 : Math.pow((v + 0.055) / 1.055, 2.4);
            });
            return 0.2126 * rgb[0] + 0.7152 * rgb[1] + 0.0722 * rgb[2];
        }

        function updateContrast(fg, bg) {
            const l1 = getLuminance(fg), l2 = getLuminance(bg);
            const ratio = (Math.max(l1,l2)+0.05) / (Math.min(l1,l2)+0.05);
            const pass = ratio >= 4.5;
            document.getElementById('contrast-text').innerText = `Contrast: ${ratio.toFixed(2)} ${pass ? 'AA' : 'Fail'}`;
            document.getElementById('status-dot').className = `status-dot ${pass ? 'pass' : 'fail'}`;
        }

        // --- Core Generator ---
        function generate() {
            const base = hexToHSL(baseColorInput.value);
            const mode = harmonyInput.value;
            const s = parseInt(satInput.value);

            currentPalette.forEach((item, i) => {
                if (item.locked) return;
                let h, l;
                if (mode === 'analogous') { h = (base.h + (i * 20)) % 360; l = 45 + (i * 8); }
                else if (mode === 'monochrome') { h = base.h; l = 25 + (i * 18); }
                else if (mode === 'complementary') { h = i % 2 === 0 ? base.h : (base.h + 180) % 360; l = 40 + (i * 10); }
                else if (mode === 'triadic') { 
                    const offsets = [0, 120, 240, 0];
                    h = (base.h + offsets[i]) % 360; l = 50; 
                }
                else { h = Math.random() * 360; l = 40 + Math.random() * 30; }
                item.hex = hslToHex(h, s, l);
            });
            render();
        }

        function render() {
            paletteContainer.innerHTML = '';
            let css = ':root {\n';
            css += `  --font-family: ${fontSelector.value};\n`;
            
            currentPalette.forEach((item, i) => {
                const div = document.createElement('div');
                div.className = 'swatch';
                div.style.background = item.hex;
                div.innerHTML = `
                    <button class="lock-btn" title="Lock Color" onclick="tLock(${i}, event)">${item.locked ? 'üîí' : 'üîì'}</button>
                    <span>${item.hex.toUpperCase()}</span>
                `;
                // FIX: No longer generates on click, now copies to clipboard
                div.onclick = () => { copyToClipboard(item.hex); };
                paletteContainer.appendChild(div);
                css += `  ${item.name}: ${item.hex};\n`;
            });
            cssExport.innerText = css + '}';

            // Update Preview Aesthetics
            previewBox.style.borderTopColor = currentPalette[0].hex;
            headingText.style.color = currentPalette[0].hex;
            previewBtn.style.background = currentPalette[0].hex;
            previewBtn.style.color = (hexToHSL(currentPalette[0].hex).l > 65) ? '#000' : '#fff';

            // Typography
            document.body.style.setProperty('--current-font', fontSelector.value);

            // Contrast Calculation
            const appBg = getComputedStyle(previewBox).backgroundColor;
            const rgbValues = appBg.match(/\d+/g).map(Number);
            const currentBgHex = "#" + rgbValues.map(x => x.toString(16).padStart(2, '0')).join('');
            updateContrast(currentPalette[0].hex, currentBgHex);
        }

        window.tLock = (i, e) => { e.stopPropagation(); currentPalette[i].locked = !currentPalette[i].locked; render(); };

        // --- Favorites ---
        function save() {
            const snap = {
                colors: currentPalette.map(p => p.hex),
                font: fontSelector.value
            };
            savedItems.unshift(snap);
            if(savedItems.length > 15) savedItems.pop();
            localStorage.setItem('aura_vault', JSON.stringify(savedItems));
            renderSaved();
        }

        function renderSaved() {
            savedContainer.innerHTML = '';
            savedItems.forEach((item, idx) => {
                const palette = Array.isArray(item) ? item : item.colors; // Support legacy format
                const div = document.createElement('div');
                div.className = 'saved-item';
                div.innerHTML = `
                    <div class="mini-group" onclick="loadSaved(${idx})">${palette.map(h => `<div class="mini-swatch" style="background:${h}"></div>`).join('')}</div>
                    <button class="btn-sec" onclick="delSaved(${idx})">‚úï</button>
                `;
                savedContainer.appendChild(div);
            });
        }

        window.loadSaved = (idx) => {
            const item = savedItems[idx];
            const palette = Array.isArray(item) ? item : item.colors;
            if (item.font) fontSelector.value = item.font;
            
            palette.forEach((h, i) => { 
                currentPalette[i].hex = h; 
                currentPalette[i].locked = true; 
            });
            baseColorInput.value = currentPalette[0].hex;
            render();
        };

        window.delSaved = (idx) => { savedItems.splice(idx, 1); localStorage.setItem('aura_vault', JSON.stringify(savedItems)); renderSaved(); };

        // --- Theme Logic ---
        function toggleTheme() {
            const isDark = document.body.hasAttribute('data-theme');
            if (isDark) {
                document.body.removeAttribute('data-theme');
                localStorage.setItem('aura_theme', 'light');
            } else {
                document.body.setAttribute('data-theme', 'dark');
                localStorage.setItem('aura_theme', 'dark');
            }
            render();
        }

        // --- Init & Listeners ---
        if (localStorage.getItem('aura_theme') === 'dark') document.body.setAttribute('data-theme', 'dark');

        baseColorInput.oninput = generate;
        harmonyInput.onchange = generate;
        satInput.oninput = generate;
        fontSelector.onchange = render;
        genBtn.onclick = () => { 
            if(!currentPalette[0].locked) baseColorInput.value = hslToHex(Math.random()*360, 70, 50); 
            generate(); 
        };
        themeBtn.onclick = toggleTheme;
        document.getElementById('save-btn').onclick = save;
        
        window.onkeydown = (e) => { 
            if(e.code === 'Space' && e.target.tagName !== 'SELECT' && e.target.tagName !== 'INPUT') { 
                e.preventDefault(); 
                genBtn.click(); 
            } 
        };

        // Run
        generate();
        renderSaved();
    </script>
</body>
</html>